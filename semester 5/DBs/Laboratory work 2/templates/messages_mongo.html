{% extends "base.html" %}
{% block content %}
<h1>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (MongoDB)</h1>

<section>
  <h2>–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h2>
  <form method="post" action="/messages/mongo/create" class="card">
    <label>Chat ID <input type="number" name="chat_id" required></label>
    <label>Sender ID <input type="number" name="sender_id" required></label>
    <label>Text <textarea name="text" rows="3" required></textarea></label>
    <label>Reactions (JSON, –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) <textarea name="reactions" rows="2" placeholder='{"üëç": [1, 2], "‚ù§Ô∏è": [3]}'></textarea></label>
    <label>Attachments (–æ–¥–∏–Ω URL –Ω–∞ —Ä—è–¥–æ–∫) <textarea name="attachments" rows="2" placeholder="https://example.com/file1.pdf"></textarea></label>
    <button type="submit">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (MongoDB)</button>
  </form>
</section>

<section>
  <h2>–°–ø–∏—Å–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</h2>
  <form method="get" action="/messages/mongo/list" class="card">
    <label>Chat ID <input type="number" name="chat_id" required></label>
    <label>Limit <input type="number" name="limit" value="50" min="1" max="200"></label>
    <label>Skip <input type="number" name="skip" value="0" min="0"></label>
    <button type="submit">–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
  </form>

  {% if rows %}
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Chat ID</th>
        <th>Sender ID</th>
        <th>Text</th>
        <th>Reactions</th>
        <th>Attachments</th>
        <th>Created At</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>{{ row._id }}</td>
        <td>{{ row.chat_id }}</td>
        <td>{{ row.sender_id }}</td>
        <td>{{ row.text or '' }}</td>
        <td>
          {% if row.reactions %}
            {% for reaction, users in row.reactions.items() %}
              {{ reaction }}: {{ users|length }}
            {% endfor %}
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          {% if row.attachments %}
            {{ row.attachments|length }} —Ñ–∞–π–ª(—ñ–≤)
          {% else %}
            -
          {% endif %}
        </td>
        <td>{{ row.created_at }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>–ù–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</p>
  {% endif %}
</section>
{% endblock %}

