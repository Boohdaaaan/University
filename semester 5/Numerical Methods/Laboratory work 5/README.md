# Лабораторна робота 5: Побудова природнього кубічного сплайну

**Автор:** Кузнецов Богдан
**Група:** ТК-31

## Опис завдання

Програма будує природній кубічний сплайн для функції:

$$
f(x) = \frac{8}{\cosh^2(2x)}
$$

на інтервалі $[-4, 4]$. Кількість вузлів інтерполяції задається користувачем.

## Аналітичні розрахунки

### 1. Визначення природнього кубічного сплайну

Кубічний сплайн $S(x)$ на інтервалі $[a, b]$ з вузлами $x_0 < x_1 < \ldots < x_{n-1}$ — це функція, яка:

1. На кожному підінтервалі $[x_i, x_{i+1}]$ є кубічним поліномом:

   $$
   S_i(x) = a_i + b_i(x - x_i) + c_i(x - x_i)^2 + d_i(x - x_i)^3
   $$

2. Задовольняє умови неперервності:
   - $S_i(x_i) = y_i$ (інтерполяція)
   - $S_i(x_{i+1}) = S_{i+1}(x_{i+1})$ (неперервність)
   - $S'_i(x_{i+1}) = S'_{i+1}(x_{i+1})$ (неперервність першої похідної)
   - $S''_i(x_{i+1}) = S''_{i+1}(x_{i+1})$ (неперервність другої похідної)

3. Для **природнього сплайну** додатково виконуються граничні умови:
   $$
   S''(x_0) = 0, \quad S''(x_{n-1}) = 0
   $$

### 2. Система рівнянь для других похідних

Позначимо $M_i = S''(x_i)$ — значення другої похідної у вузлі $x_i$.

Для внутрішніх вузлів $i = 1, 2, \ldots, n-2$ виконується рівняння:

$$
\mu_i M_{i-1} + 2M_i + \lambda_i M_{i+1} = d_i
$$

де:
- $h_i = x_{i+1} - x_i$ — відстань між вузлами
- $\mu_i = \frac{h_{i-1}}{h_{i-1} + h_i}$
- $\lambda_i = \frac{h_i}{h_{i-1} + h_i}$
- $d_i = \frac{6}{h_{i-1} + h_i} \left( \frac{y_{i+1} - y_i}{h_i} - \frac{y_i - y_{i-1}}{h_{i-1}} \right)$

Для природнього сплайну:
$$
M_0 = 0, \quad M_{n-1} = 0
$$

Таким чином, отримуємо систему $(n-2)$ рівнянь з $(n-2)$ невідомими $M_1, M_2, \ldots, M_{n-2}$.

### 3. Тридіагональна система та метод прогонки

Система рівнянь має тридіагональну структуру:

$$
\begin{pmatrix}
2 & \lambda_1 & 0 & \cdots & 0 \\
\mu_2 & 2 & \lambda_2 & \cdots & 0 \\
0 & \mu_3 & 2 & \cdots & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
0 & 0 & 0 & \cdots & 2
\end{pmatrix}
\begin{pmatrix}
M_1 \\
M_2 \\
M_3 \\
\vdots \\
M_{n-2}
\end{pmatrix}
=
\begin{pmatrix}
d_1 \\
d_2 \\
d_3 \\
\vdots \\
d_{n-2}
\end{pmatrix}
$$

Для розв'язання використовується **метод прогонки** (алгоритм Томаса).

#### Прямий хід

$$
\alpha_1 = -\frac{\lambda_1}{2}, \quad \beta_1 = \frac{d_1}{2}
$$

$$
\alpha_i = -\frac{\lambda_i}{2 + \mu_i \alpha_{i-1}}, \quad \beta_i = \frac{d_i - \mu_i \beta_{i-1}}{2 + \mu_i \alpha_{i-1}}, \quad i = 2, \ldots, n-2
$$

#### Зворотний хід

$$
M_{n-2} = \beta_{n-2}
$$

$$
M_i = \alpha_i M_{i+1} + \beta_i, \quad i = n-3, \ldots, 1
$$

### 4. Обчислення коефіцієнтів сплайну

Після знаходження $M_i$, коефіцієнти на кожному інтервалі $[x_i, x_{i+1}]$ обчислюються за формулами:

$$
a_i = y_i
$$

$$
b_i = \frac{y_{i+1} - y_i}{h_i} - \frac{h_i(2M_i + M_{i+1})}{6}
$$

$$
c_i = \frac{M_i}{2}
$$

$$
d_i = \frac{M_{i+1} - M_i}{6h_i}
$$

### 5. Обчислення значення сплайну в точці

Для точки $x \in [x_i, x_{i+1}]$:

$$
S(x) = a_i + b_i(x - x_i) + c_i(x - x_i)^2 + d_i(x - x_i)^3
$$

## Алгоритм програми

1. **Введення даних:** Користувач вводить кількість вузлів $n \geq 2$.

2. **Розподіл вузлів:** Створюється рівномірний розподіл на інтервалі $[-4, 4]$:

   $$
   x_i = -4 + i \cdot h, \quad h = \frac{8}{n-1}, \quad i = 0, 1, \ldots, n-1
   $$

3. **Обчислення значень функції:** $y_i = f(x_i) = \frac{8}{\cosh^2(2x_i)}$

4. **Побудова системи рівнянь:** Формується тридіагональна система для $M_1, \ldots, M_{n-2}$.

5. **Розв'язання системи:** Використовується метод прогонки.

6. **Обчислення коефіцієнтів:** Для кожного сегменту обчислюються $a_i, b_i, c_i, d_i$.

7. **Виведення результатів:** Таблиця вузлів, коефіцієнти сплайну, аналіз похибки.

8. **Збереження графіка:** Графік зберігається у форматі SVG (`graph.svg`).

## Вимоги

- Компілятор C++ з підтримкою стандарту C++11 або новішого
- Стандартна бібліотека C++

## Компіляція та запуск

### Компіляція

```bash
cd "Laboratory work 5"
g++ -std=c++11 -O2 -o spline main.cpp
```

Або використовуючи Makefile:

```bash
make
```

### Запуск

```bash
./spline
```

Програма запросить введення кількості вузлів інтерполяції.

## Приклад використання

```
Введіть кількість вузлів інтерполяції (n >= 2): 10
```

Програма виведе:
- Таблицю вузлів інтерполяції
- Коефіцієнти сплайну для кожного сегменту
- Аналіз похибки інтерполяції
- Графік у форматі SVG

## Побудова графіка

Після виконання програми автоматично створюється файл `graph.svg` з графіком в форматі SVG.

## Особливості реалізації

1. **Метод прогонки:** Ефективний алгоритм для розв'язання тридіагональних систем зі складністю $O(n)$.

2. **Обробка граничних випадків:** Програма коректно обробляє випадок $n = 2$ (лінійна інтерполяція).

3. **Екстраполяція:** Для точок поза інтервалом використовується екстраполяція на основі крайніх сегментів.

4. **Аналіз похибки:** Програма обчислює максимальну та середню похибку інтерполяції на тестових точках.

## Теоретичні властивості природнього сплайну

1. **Мінімальна кривина:** Природній сплайн мінімізує інтеграл квадрата другої похідної:

   $$
   \int_{x_0}^{x_{n-1}} [S''(x)]^2 dx \to \min
   $$

2. **Оптимальна апроксимація:** Серед усіх функцій з неперервною другою похідною, що інтерполюють дані точки, природній сплайн має найменшу "енергію".

3. **Збіжність:** При збільшенні кількості вузлів сплайн збігається до інтерполюваної функції (якщо функція досить гладка).